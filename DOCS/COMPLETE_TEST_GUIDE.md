# Coordy完全テストガイド

## 概要

このガイドでは、Coordyアプリケーションの全機能を体系的にテストする手順を説明します。ユーザー登録からサービス予約までの完全なフローをカバーしています。

## 前提条件

### 環境セットアップ

1. **バックエンドのデプロイ**
   ```bash
   npx ampx sandbox
   # または
   npx ampx deploy
   ```

2. **サンプルデータの投入**
   ```bash
   npx tsx scripts/seed-services.ts
   ```
   詳細は[SEED_DATA.md](./SEED_DATA.md)を参照

3. **開発サーバーの起動**
   ```bash
   npm run dev
   ```

4. **アクセス**
   - ブラウザで http://localhost:3000 を開く

## テストシナリオ

### 1. 新規ユーザー登録（クライアント）

#### 1.1 サインアップページへ移動

1. トップページから「新規登録」をクリック
2. または直接 http://localhost:3000/signup/user にアクセス

#### 1.2 アカウント作成

**入力情報**:
```
名前: テスト太郎
メールアドレス: test-user-001@example.com
パスワード: TestPassword123!
パスワード確認: TestPassword123!
```

**確認項目**:
- [ ] すべてのフィールドが必須であること
- [ ] パスワードが一致しない場合、エラーが表示されること
- [ ] メールアドレス形式が正しくない場合、エラーが表示されること
- [ ] 「登録する」ボタンをクリック後、検証コード入力画面に遷移すること

#### 1.3 メール検証

1. メールボックスを確認（開発環境ではコンソールログにも表示される）
2. 6桁の検証コードをコピー
3. 検証コード入力画面で入力
4. 「確認」ボタンをクリック

**確認項目**:
- [ ] 正しい検証コードで認証が成功すること
- [ ] 間違った検証コードでエラーが表示されること
- [ ] 検証成功後、ログインページにリダイレクトされること

#### 1.4 初回ログイン

**入力情報**:
```
メールアドレス: test-user-001@example.com
パスワード: TestPassword123!
```

**確認項目**:
- [ ] ログインに成功すること
- [ ] プロフィール設定ページ (`/user/profile/setup`) にリダイレクトされること

### 2. プロフィール設定（必須）

#### 2.1 プロフィール情報入力

**入力情報**:
```
名前: テスト太郎
住所: 東京都渋谷区1-2-3
電話番号: 090-1234-5678
生年月日: 1990-01-01
性別: 男性
```

**確認項目**:
- [ ] 名前、住所、電話番号が必須項目であること
- [ ] 生年月日と性別は任意項目であること
- [ ] すべての必須項目を入力後、「保存してダッシュボードへ」ボタンが有効になること
- [ ] 保存成功後、ダッシュボードにリダイレクトされること

#### 2.2 プロフィール完了チェック

**確認項目**:
- [ ] プロフィール未完了の状態でダッシュボードに直接アクセスしようとすると、プロフィール設定ページにリダイレクトされること
- [ ] プロフィール完了後は、自由にダッシュボードにアクセスできること

### 3. ダッシュボード確認

#### 3.1 ヘッダー確認

**確認項目**:
- [ ] ハンバーガーメニューアイコンが表示されていること
- [ ] 戻るボタンが表示されていること
- [ ] Coordyブランドロゴとホームアイコンが表示されていること
- [ ] ユーザー名「テスト太郎さん」が表示されていること（PC表示）
- [ ] 「クライアント」ロールバッジが表示されていること（PC表示）
- [ ] ポイント残高「0pt」が表示されていること（PC表示）
- [ ] ログアウトボタンが表示されていること
- [ ] プロフィールアイコンが表示されていること

#### 3.2 サイドバー確認

1. ハンバーガーメニューをクリック

**確認項目**:
- [ ] サイドバーが左からスライドして表示されること
- [ ] 以下のメニュー項目が表示されること：
  - [ ] ホーム
  - [ ] サービス検索
  - [ ] 自分の予定
  - [ ] お気に入り
  - [ ] 活動履歴
  - [ ] ポイント
  - [ ] 支払い
  - [ ] プロフィール
  - [ ] 設定
- [ ] 最下部に「ログアウト」ボタンが表示されること
- [ ] もう一度ハンバーガーメニューをクリックすると、サイドバーが閉じること
- [ ] サイドバー外をクリックすると、サイドバーが閉じること

#### 3.3 ダッシュボードコンテンツ

**確認項目**:
- [ ] ウェルカムカード（紫グラデーション）が表示されていること
- [ ] 「次の予約」カードが表示され、「予約はまだありません」と表示されること
- [ ] 「今日のTODO」カードが表示され、「TODOはまだありません」と表示されること
- [ ] 「クイックアクション」カードが表示されていること
- [ ] 「あなたへのおすすめサービス」セクションが表示されていること
- [ ] サンプルデータが投入されている場合、サービスカードが最大6件表示されること
- [ ] 各サービスカードに以下が表示されていること：
  - [ ] サービスタイトル
  - [ ] サービス説明（一部）
  - [ ] カテゴリーバッジ
  - [ ] 所要時間
  - [ ] 価格（ポイント表示）
  - [ ] クリエイター名

### 4. ポイントチャージ

#### 4.1 ウォレットページへ移動

**方法1**: ヘッダーのポイント残高表示をクリック
**方法2**: サイドバーの「ポイント」メニューをクリック
**方法3**: 直接 http://localhost:3000/user/wallet にアクセス

#### 4.2 残高確認

**確認項目**:
- [ ] 現在の残高が大きく表示されていること（初期値: 0pt）
- [ ] 残高表示カードが紫〜ピンクのグラデーションであること

#### 4.3 クレジットカードでチャージ

**操作手順**:
1. チャージ額に「5000」と入力
2. 「クレジットカード」を選択（デフォルト選択状態）
3. 「チャージする」ボタンをクリック

**確認項目**:
- [ ] チャージ成功メッセージが表示されること
- [ ] 残高が5,000ptに更新されること
- [ ] 取引履歴に「チャージ +5,000pt」が即座に追加されること
- [ ] 取引履歴のステータスが「completed」であること
- [ ] ヘッダーのポイント表示も更新されること

#### 4.4 銀行振込でチャージ

**操作手順**:
1. チャージ額に「3000」と入力
2. 「銀行振込」を選択
3. 振込先情報が表示されることを確認
4. 「チャージする」ボタンをクリック

**確認項目**:
- [ ] 振込先情報（銀行名、支店名、口座番号、口座名義）が表示されること
- [ ] チャージ申請成功メッセージが表示されること
- [ ] メッセージに「承認後にポイントが追加されます」と表示されること
- [ ] 取引履歴に「チャージ +3,000pt」が追加されること
- [ ] 取引履歴のステータスが「承認待ち」（pending）であること
- [ ] 残高は即座には増えないこと（承認待ちのため）

#### 4.5 ポイント残高の表示確認

**確認項目**:
- [ ] ウォレットページに最新の残高が表示されていること
- [ ] ヘッダーのポイント表示が更新されていること
- [ ] 別のページに移動しても、ヘッダーの残高表示が保持されていること

### 5. サービス検索と閲覧

#### 5.1 サービス一覧ページへ移動

**方法1**: ダッシュボードの「あなたへのおすすめサービス」セクションの「すべて見る」をクリック
**方法2**: サイドバーの「サービス検索」をクリック
**方法3**: 直接 http://localhost:3000/user/services にアクセス

#### 5.2 サービス一覧の確認

**確認項目**:
- [ ] 公開されているすべてのサービスが表示されること
- [ ] カテゴリー別フィルターが利用できること（実装されている場合）
- [ ] 各サービスカードが正しく表示されること

#### 5.3 サービス詳細ページ

**操作手順**:
1. 任意のサービスカードをクリック

**確認項目**:
- [ ] サービス詳細ページに遷移すること
- [ ] 以下の情報が表示されること：
  - [ ] サービスタイトル
  - [ ] 詳細説明
  - [ ] カテゴリー
  - [ ] 所要時間
  - [ ] 価格（ポイント）
  - [ ] クリエイター情報
  - [ ] タグ一覧
- [ ] 「予約する」ボタンが表示されること（実装されている場合）

### 6. お気に入り機能

#### 6.1 お気に入りクリエイターの追加

**操作手順**:
1. サービス詳細ページでクリエイター名をクリック（実装されている場合）
2. または、クリエイター一覧ページから任意のクリエイターを選択
3. 「お気に入りに追加」ボタンをクリック

**確認項目**:
- [ ] お気に入りに追加成功メッセージが表示されること
- [ ] ダッシュボードに戻ると「お気に入りクリエイターのサービス」セクションが表示されること
- [ ] そのクリエイターのサービスがセクションに表示されること

#### 6.2 お気に入り管理ページ

**操作手順**:
1. サイドバーの「お気に入り」をクリック
2. または、ダッシュボードの「お気に入りクリエイターのサービス」セクションの「お気に入り管理」をクリック

**確認項目**:
- [ ] お気に入りに登録したクリエイター一覧が表示されること
- [ ] 各クリエイターの詳細情報が表示されること
- [ ] お気に入りから削除できること

### 7. サービス予約（実装状況に応じて）

#### 7.1 予約フロー

**操作手順**:
1. サービス詳細ページで「予約する」ボタンをクリック
2. 日時を選択
3. 参加人数を選択（該当する場合）
4. 備考を入力（任意）
5. ポイント確認
6. 「予約を確定する」ボタンをクリック

#### 7.2 ポイント残高チェック

**テストケース1: 十分なポイントがある場合**
- [ ] 予約が成功すること
- [ ] ポイントが差し引かれること
- [ ] 予約一覧に追加されること
- [ ] ポイント取引履歴に「使用」レコードが追加されること

**テストケース2: ポイントが不足している場合**
- [ ] エラーメッセージが表示されること
- [ ] 「ポイントをチャージする」リンクが表示されること
- [ ] 予約は作成されないこと

#### 7.3 予約確認

**確認項目**:
- [ ] 「自分の予定」ページに予約が表示されること
- [ ] ダッシュボードの「次の予約」カードに予約が表示されること
- [ ] 予約詳細ページで情報が確認できること

### 8. プロフィール管理

#### 8.1 プロフィール閲覧

**操作手順**:
1. ヘッダーのプロフィールアイコンをクリック
2. または、サイドバーの「プロフィール」をクリック

**確認項目**:
- [ ] 登録したプロフィール情報が表示されること
- [ ] 名前、住所、電話番号、生年月日、性別が確認できること

#### 8.2 プロフィール編集

**操作手順**:
1. 「編集」ボタンをクリック
2. 情報を変更
3. 「保存」ボタンをクリック

**確認項目**:
- [ ] 変更が保存されること
- [ ] ヘッダーの表示名も更新されること

### 9. ログアウトとログイン

#### 9.1 ログアウト

**方法1**: ヘッダーの「ログアウト」ボタンをクリック（PC表示）
**方法2**: ヘッダーのログアウトアイコンをクリック（モバイル表示）
**方法3**: サイドバー下部の「ログアウト」ボタンをクリック

**確認項目**:
- [ ] ログアウトが成功すること
- [ ] ログインページにリダイレクトされること
- [ ] セッションがクリアされること

#### 9.2 再ログイン

**操作手順**:
1. メールアドレスとパスワードを入力
2. 「ログイン」ボタンをクリック

**確認項目**:
- [ ] ログインに成功すること
- [ ] プロフィール設定済みのため、ダッシュボードに直接遷移すること（プロフィール設定ページにはリダイレクトされない）
- [ ] 以前の状態（ポイント残高、予約など）が保持されていること

### 10. レスポンシブデザイン確認

#### 10.1 モバイル表示（375px以下）

**確認項目**:
- [ ] ヘッダーが適切に縮小表示されること
- [ ] ユーザー名とロールバッジが非表示になること
- [ ] ポイント残高が非表示になること
- [ ] ログアウトがアイコンのみ表示になること
- [ ] サービスカードが1カラムで表示されること
- [ ] サイドバーが画面全体を覆うこと

#### 10.2 タブレット表示（768px〜1024px）

**確認項目**:
- [ ] サービスカードが2カラムで表示されること
- [ ] ポイント残高が表示されること
- [ ] ヘッダーの要素が適切に配置されていること

#### 10.3 デスクトップ表示（1024px以上）

**確認項目**:
- [ ] サービスカードが3カラムで表示されること
- [ ] すべてのヘッダー要素が表示されること
- [ ] サイドバーが左寄せ（320px幅）で表示されること

## エラーケーステスト

### 認証エラー

**テストケース**:
1. 間違ったパスワードでログイン試行
2. 存在しないメールアドレスでログイン試行
3. セッション期限切れ後のAPI呼び出し

**確認項目**:
- [ ] 適切なエラーメッセージが表示されること
- [ ] ログインページにリダイレクトされること

### ポイント不足エラー

**テストケース**:
1. ポイント残高以上の価格のサービスを予約しようとする

**確認項目**:
- [ ] 「ポイントが不足しています」というエラーメッセージが表示されること
- [ ] チャージページへのリンクが表示されること

### ネットワークエラー

**テストケース**:
1. オフライン状態でページを操作
2. API呼び出し中にネットワークを切断

**確認項目**:
- [ ] エラーメッセージが表示されること
- [ ] リトライ機能が提供されること（実装されている場合）

## パフォーマンステスト

### ページ読み込み速度

**確認項目**:
- [ ] ダッシュボードが3秒以内に表示されること
- [ ] サービス一覧が5秒以内に表示されること（サンプルデータ9件の場合）

### データ更新

**確認項目**:
- [ ] ポイントチャージ後、即座に残高が更新されること
- [ ] 予約作成後、即座に予約一覧に反映されること

## セキュリティテスト

### 認可チェック

**テストケース**:
1. ログアウト状態で保護されたページ（`/user/`配下）に直接アクセス
2. 他のユーザーのプロフィールURLに直接アクセス（可能な場合）

**確認項目**:
- [ ] ログインページにリダイレクトされること
- [ ] 他のユーザーのデータにアクセスできないこと

### プロフィール完了チェック

**テストケース**:
1. プロフィール未完了の状態でダッシュボードに直接アクセス

**確認項目**:
- [ ] プロフィール設定ページにリダイレクトされること
- [ ] プロフィール設定ページ以外の保護ページにアクセスできないこと

## ブラウザ互換性テスト

**テスト対象ブラウザ**:
- [ ] Chrome（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [ ] Edge（最新版）
- [ ] モバイルSafari（iOS）
- [ ] Chrome（Android）

## チェックリストサマリー

### 必須機能

- [ ] ユーザー登録（サインアップ）
- [ ] メール検証
- [ ] ログイン・ログアウト
- [ ] プロフィール設定（初回必須）
- [ ] プロフィール完了チェック
- [ ] ダッシュボード表示
- [ ] ヘッダー（ハンバーガー、戻る、ブランド、ユーザー情報、ポイント、ログアウト、プロフィール）
- [ ] サイドバー（トグル動作、メニュー一覧、ウォレットリンク）
- [ ] ポイントチャージ（クレジットカード・銀行振込）
- [ ] ポイント残高表示
- [ ] サービス一覧表示（おすすめサービス）
- [ ] サービスカード表示
- [ ] お気に入りクリエイター機能

### オプション機能（実装状況に応じて）

- [ ] サービス予約
- [ ] 予約一覧
- [ ] 活動履歴
- [ ] カレンダー表示
- [ ] TODO管理

## トラブルシューティング

### よくある問題

**問題1**: サービスが表示されない

**解決策**:
- サンプルデータが投入されているか確認
- サービスのステータスが`'published'`であることを確認
- ブラウザのコンソールでエラーログを確認

**問題2**: ポイント残高が更新されない

**解決策**:
- ページをリロード
- ブラウザキャッシュをクリア
- 取引履歴で実際にチャージが記録されているか確認

**問題3**: プロフィール設定ページから抜け出せない

**解決策**:
- すべての必須項目（名前、住所、電話番号）が入力されているか確認
- ブラウザのコンソールでエラーを確認
- データベースで`isProfileComplete`フラグが`true`になっているか確認

## まとめ

このテストガイドに従って、Coordyアプリケーションの主要機能を網羅的にテストしてください。各セクションのチェックボックスを活用して、テスト進捗を管理することをおすすめします。

問題が発生した場合は、ブラウザの開発者ツール（Consoleタブ）でエラーログを確認し、必要に応じて関連ドキュメントを参照してください。
