あなたは /mnt/Coordy リポジトリで動作している AI 開発アシスタントです。
Next.js(App Router) + Amplify(Cognito) プロジェクトのフロント／認証まわりの不具合を修正してください。

今回やってほしいことは主にこの2点です：

1. `/` 初回アクセス時の Header ログインボタンが効かない問題の解消（タスク化して順序立てて対応）
2. `/manage/login` が `/instructor` にリダイレクトされてしまう問題の修正と、管理ページの実装確認・必要な修正

---

## 0. 作業前のルール

### 0-1. まず読む DOCS（必須）

作業を始める前に、必ず以下を読み、現状仕様を把握してください。

- DOCS/README.md
- DOCS/site-map.md
- DOCS/flows/login-flow.md
- DOCS/AUTH.md
- DOCS/IMPLEMENTATION.md
- DOCS/flows/main-user-flows.md

特に：

- user / instructor / admin ロールの扱い
- 管理者ログインフロー（/manage/login → /manage/admin 等）の仕様
- 公開トップページ `/` と Header の構造

を把握した上で作業してください。

### 0-2. DOCS の扱い

- DOCS 配下の .md ファイルは **削除しない／リネームしない**。
- 仕様と実装にズレがあれば、今回の要望を正として、
  - DOCS の該当セクションだけを **最小限** 修正して整合性をとる。
- 新しい仕様を追記する場合も、「セクション追加」「表の行追加」レベルにとどめてください。

### 0-3. タスク宣言（必須）

作業を始める前に、今回の作業を **T-001, T-002, ...** の形で Markdown テーブルとして宣言してください。

例（内容は状況を見てあなたが調整）：

| Task ID | 内容 |
|--------|------|
| T-001  | `/` 初回アクセス時の Header ログインボタンが効かない問題の原因調査と修正 |
| T-002  | `/manage/login` が `/instructor` にリダイレクトされる問題の調査と修正 |
| T-003  | 管理ページ（/manage/admin 等）の実装状況確認と必要最小限の修正 |
| T-004  | DOCS（AUTH.md, login-flow.md, site-map.md）の仕様更新 |
| T-005  | `npm run build` による最終確認 |

このようにタスクを分解して宣言したうえで、タスク順に作業してください。

---

## 1. `/` 初回アクセス時の Header ログインボタンが効かない問題

### 症状（ユーザー報告）

- URL: `http://localhost:3000/`
- 初回アクセス時に、Header の「ログイン」ボタンがクリックできない。
- ブラウザでリロードするとクリックできるようになる。
- つまり、「初回表示のみ」何かがかぶっていて操作できない状態。

前回までに以下のような対応が行われていますが、まだ問題は解消していません：

- app/layout.tsx で Sheet（サイドバー）を保護ルートのみでレンダリングするよう変更。
- z-index や SidebarProvider 周りの調整（/user 側など）は実施済み。

ただし、**公開トップページ `/` の初回アクセスでログインボタンが効かない現象は残っています。**

### やってほしいこと（T-001）

1. 関連しそうなコンポーネント／レイアウトを洗い出す：
   - app/layout.tsx（グローバルレイアウト）
   - components/common/Header.tsx（または類似の Header コンポーネント）
   - components/modals/LoginModal.tsx
   - サイドバー関連（SidebarProvider.tsx など）が `/` に影響していないか
2. `/` 初回アクセス時に、Header 上に何か透明な要素やオーバーレイがかぶっていないかを調べる：
   - position / z-index / pointer-events の組み合わせ
   - 条件付きレンダリング（クライアントマウント前の状態など）で意図せず重なっていないか
3. 原因を特定したら、次のような状態に修正してください：
   - `/` に初回アクセスした直後から、Header の「ログイン」ボタンが普通にクリックできる。
   - モーダルや Sheet、オーバーレイが不要に Header の上に乗らない。
   - すでに実装済みの `/user` / `/instructor` 側のレイアウトは壊さない。
4. 必要であれば、`DOCS/flows/login-flow.md` に「トップページからのログイン導線」の挙動を簡潔に追記しても構いません（最小限にしてください）。

---

## 2. `/manage/login` が `/instructor` にリダイレクトされてしまう問題

### 症状（ユーザー報告）

- URL: `http://localhost:3000/manage/login`
- 管理ログインにアクセスすると、なぜか `http://localhost:3000/instructor` にリダイレクトされてしまう。
- そのため、管理画面にアクセスできない。

前回のレポートでは：

- `/manage/login` は「管理者ログインページ（Cognito認証）」として完全実装済み
- `/manage/admin` や `/manage/(protected)/layout.tsx` も「admin 以外リダイレクト」として完全実装済み

と記載されていますが、実際の挙動とは噛み合っていません。

### 要件（こうなっていてほしい）

1. `/manage/login`
   - 未ログイン時：
     - 管理者候補のユーザーがアクセスできる。
     - ログインフォームを表示する（admin でないユーザーでも一旦フォームは出て良い）。
   - admin ロールで既にログイン済みの場合：
     - `/manage/admin` にリダイレクトしてよい。
   - user / instructor ロールでログイン済みの場合：
     - 強制的に `/instructor` に飛ばすのではなく、少なくとも「管理者としてログインし直せる」ようにしたい。
     - 最低限、「管理者ではないため管理画面には入れません」等のメッセージ表示か、/ のような安全な場所へのリダイレクトなどにしてください。

2. `/manage/admin`
   - admin ロールのみアクセス可能。
   - admin でない場合は、適切な場所にリダイレクト（例：`/` や `/login/user`）＋エラーメッセージなど。

3. 管理ページ自体
   - `app/manage/(protected)/admin/page.tsx` 等が存在し、
     - 少なくとも「管理ダッシュボード（仮）」として最低限の UI がある状態にしてほしい。
   - もしまだ仮実装・TODO 状態なら、今わかる範囲で「今はこういう簡易画面」として整えておいてください。

### やってほしいこと（T-002, T-003）

1. 次のファイルを中心に、リダイレクトロジックを確認してください：
   - app/manage/login/page.tsx
   - app/manage/(protected)/layout.tsx
   - middleware.ts（あれば）
   - lib/auth/cognito.ts（ロール判定）
2. なぜ `/manage/login` アクセスが `/instructor` に飛ばされるのかを特定し、
   - admin ログインフローの仕様に沿うようにリダイレクト条件を修正してください。
3. 管理者ロールの定義：
   - 前回レポートによると、Cognito の ADMINS グループ所属ユーザーを admin と認識しているはずなので、
     - その前提を維持しつつ、admin 以外のユーザーが `/manage/login` にアクセスしたときの挙動を整理してください。
4. `DOCS/AUTH.md` / `DOCS/flows/login-flow.md` / `DOCS/site-map.md` に、
   - 管理者ログインページ `/manage/login`
   - 管理ダッシュボード `/manage/admin`
   - 管理者ロール判定（ADMINS グループ）
   - 非 admin ユーザーが `/manage/login` にアクセスしたときの挙動
   を簡潔に追記・修正してください（既に書いてある場合は実装と齟齬がないように更新）。

---

## 3. 最終確認とレポート

すべてのタスク対応後、次を自己チェックしてください：

1. `http://localhost:3000/`
   - 初回アクセス時から Header の「ログイン」ボタンがクリックできる。
   - リロードしなくてもログインモーダルが開く。

2. `http://localhost:3000/manage/login`
   - 未ログイン時に正常に管理者ログインフォームが表示される。
   - admin ロールのユーザーでログインすると `/manage/admin` に遷移できる。
   - user / instructor ロールでログイン中の場合、意図しない `/instructor` への自動リダイレクトは発生しない。

3. `http://localhost:3000/manage/admin`
   - admin ロールでアクセスすると管理ページが表示される。
   - admin 以外が直接アクセスした場合は適切にブロック・リダイレクトされる。

4. `npm run build`
   - 成功すること（ESLint 警告はあってもよいが、ビルドは通す）。

最後に、「作業完了レポート」を Markdown で出力してください：

- タスク一覧（T-001〜）と対応内容
- 変更したファイル一覧（パス＋概要）
- 実行したコマンド（lint / build など）と結果
- DOCS にどのような変更を加えたか
- まだ残っている懸念点・TODO があれば明示

