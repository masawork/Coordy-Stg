あなたは /mnt/Coordy リポジトリを担当する シニアフルスタックエンジニア兼 AI コーディングアシスタント です。
Next.js（App Router） + AWS Amplify（Cognito, Amplify Data）で構築中のサービスの実装・改修を、自動でタスク分解しながら進めてください。

実装方針:

基本は DOCS 配下の設計どおりに実装 すること

設計が足りない／矛盾している箇所は、あなたが UI/UX とセキュリティを考えて最適案を決めてよい

仕様を変えた／追加した場合は、必ず対応する DOCS/*.md を 最小限の変更で更新 すること

UI/UX方針:

ユーザーが迷わない導線と、分かりやすいエラー表示を最優先

セキュリティ（認証・認可・ロール分離、危険な表示名の禁止など）も必ず考慮

必要に応じて Midworks / クラウドワークス の画面構成・文言・導線をブラウザで軽く確認し、良いところを取り入れてよい

開発スタイル:

あなたが「裏で作業するエンジニア」、私は「途中でレビュー＆テストを行う PO」というイメージです

タスクを T-001, T-002… のように自分で分解し、自律的にコードと DOCS を編集 してください

大きめの区切りごとに、簡単な進捗レポートを出して、私がブラウザで確認できるようにしてください

ただし、私が止めるまで「ここで終わりにしませんか？」などとは聞かず、依頼範囲内は自動で詰めてください

禁止／注意:

DOCS 配下の .md ファイルは 削除・リネーム禁止

内容が古い場合は「今回の仕様を正」として、必要部分のみ更新

rm -rf は .next などの一時ファイル以外には使わない

既に動いているログインフローやプロフィールフローを壊さないよう、必ず画面動作も確認すること

0. 事前調査タスク（T-000）

まず、以下を実行して現在の構成と DOCS をざっくり把握してください：

ls

ls DOCS

cat package.json

cat DOCS/README.md

cat DOCS/site-map.md

cat DOCS/flows/login-flow.md

cat DOCS/flows/main-user-flows.md

cat DOCS/AUTH.md

cat DOCS/IMPLEMENTATION.md

そのうえで、今回のタスクに関係しそうなファイル（特に lib/auth/*, lib/api/*, app/user/*, app/instructor/*, app/manage/* など）も ls / rg / cat で確認し、1〜2段落程度のテキストで状況サマリ を出してください。

1. 認証ガード・リダイレクトの整理（T-101）
要件

/user

未ログインのときは / にリダイレクトする（ユーザー／インストラクター／管理者いずれのセッションもない状態）

/instructor

同様に、未ログインのときは / にリダイレクト

ロールごとのアクセス制御

管理者ログイン状態で /user や /instructor にアクセスしようとした場合は、各ロール用エリアには入れない

例：admin ログイン中に /user へ行く → 適切なエラー or リダイレクト

すでに「各ユーザのロールにアクセスできないようにしてほしい」と依頼済みなので、現状の挙動と DOCS を照らし合わせて整理・実装

既存のログイン・サインアップ・プロフィールフローが壊れないこと

実装・確認のポイント

すでに middleware.ts や (protected) レイアウトで認証チェックが入っている場合、それを尊重しつつ修正

ロール判定は lib/auth/cognito.ts のロジックに合わせること（groups, custom:role など）

必要に応じて DOCS/flows/login-flow.md および DOCS/AUTH.md に「ロールごとのアクセス制御」のセクションを作成／更新

管理者がユーザー／インストラクター画面へ直接アクセスできないこと

ユーザー ↔ インストラクターの切り替えルール　など

2. ユーザープロフィール作成時の GraphQL エラー修正（T-201）
現象

http://localhost:3000/user/profile/setup でプロフィール保存時にエラー：

プロフィールの保存に失敗しました。プロフィールの作成に失敗しました:
[{"path":null,"locations":null,"message":"The variables input contains a field that is not defined for input object type 'CreateClientProfileInput' "}]

やること

関連ファイル確認：

amplify/data/resource.ts

生成された GraphQL スキーマ（CreateClientProfileInput が分かるファイル）

lib/api/profile.ts

app/user/(protected)/profile/setup/page.tsx

CreateClientProfileInput に含まれていないフィールド（例：displayName など）が input に混ざっていないか確認

以下のどちらかで整合性を取る：

スキーマ側にないフィールドは 作成時には送らず、必要なら別の更新 API で扱う

もしくは本来スキーマにあるべきフィールドであれば、amplify/data/resource.ts を正として schema を直し、amplify codegen 等を回す前提のコードに修正（今回は前者優先でよい）

修正後：

新規ユーザーが /user/profile/setup でプロフィールを保存できること

再読み込み後にプロフィール情報が正常に取得・表示されること

エラー原因と修正内容を、簡単なコメント or DOCS（DOCS/flows/main-user-flows.md）に記述

3. インストラクター用プロフィール設定フォーム調整（T-301）
要件

対象: http://localhost:3000/instructor/profile/setup

名前入力欄の追加

本名を入力するフィールドを追加（Admin が承認時に確認するための名前）

例：本名（管理者のみ確認） のようなラベルで、フロントには公開しない前提でもよい

「時給」フィールドの削除

現状ある「時給」のような項目は削除

報酬は各サービス作成時に設定するため、プロフィールには不要

実装方法

既存のユーザープロフィール（/user/profile/setup）を参考に実装

lib/api/instructors.ts など、インストラクタープロフィール用 API も確認して整合性を取る

DOCS 更新

DOCS/flows/main-user-flows.md にインストラクタープロフィールの入力項目を追記

Admin 承認時に本名を使うことを DOCS/AUTH.md または適切なドキュメントに記述

4. 表示名の禁止文言チェック（ユーザー＆インストラクター）（T-401）
要件

対象: ユーザー／インストラクター両方の「表示名（ニックネーム）」フィールド

表示名に禁止ワード／不適切表現チェックを追加

暴力的・差別的・わいせつなど、人が不快になる表現を弾く

具体的な実装案：

lib/validation/displayName.ts のようなユーティリティを作成し、NGワードリスト／簡易NGパターンを定義

クライアント側でのバリデーションに加えて、バックエンド側（GraphQL/API 呼び出し直前）でもチェックし、すり抜けを防ぐ

UX に配慮したエラーメッセージ

例：「不適切な表現が含まれている可能性があります。別の表示名をお試しください。」など、具体的なワードは出さない

DOCS 反映

DOCS/flows/main-user-flows.md か DOCS/AUTH.md に、「表示名の禁止ルール」を1セクションとして明記

5. インストラクターダッシュボードのサブメニュー修正（T-501）
要件

対象: http://localhost:3000/instructor

サブメニューからのリンクがすべて 404 になっている

やること：

サブメニューコンポーネント（components/layout/InstructorSidebar など）を特定

リンク先ルート（app/instructor/(protected)/**）と照合し、存在しないパスを修正 or ページを追加

サービス一覧／予約状況／プロフィール／設定…など、必要最低限のメニューとパスを DOCS/site-map.md と合わせて整理

Midworks / クラウドワークスの「マイページ（出品者側）」を参考に、メニュー構成や文言を調整してよい

6. 管理画面のサイドバー初期状態（T-601）
要件

対象: http://localhost:3000/manage/admin

ユーザー画面と同様に、管理画面のハンバーガーメニュー（サイドバー）を 初期状態から表示された状態 にする

すでにユーザー側（/user）で実装しているロジック（デスクトップ時はサイドバー開、モバイル時は閉）を、管理側レイアウトにも適用

確認：

デスクトップ幅で /manage/admin にアクセスしたとき、サイドバーが開いていてメインコンテンツが縮んで表示されること

7. ロールごとのアクセス制御と DOCS 反映（T-701）
要件

現状、「管理者ログイン状態でユーザーログイン画面へ行こうとすると管理画面（https://localhost:3000/admin
 など）にリダイレクトされる」といった挙動がある

方針：

管理者・ユーザー・インストラクターはそれぞれのエリアにのみアクセス可能

ログイン画面にアクセスした場合の挙動は、DOCS の設計と合わせて整理

やること：

lib/auth/cognito.ts と各 (protected)/layout.tsx / middleware.ts を確認し、現状のロール判定とリダイレクトロジックを把握

上記「1. 認証ガード・リダイレクト整理」で決めたルールに沿うようにコードを修正

DOCS/flows/login-flow.md と DOCS/AUTH.md に「ロールごとのアクセスルール」を明確に記載

管理者がユーザーエリアをどう扱うか

逆にユーザー／インストラクターが管理エリアに来たときどうするか

8. テスト・ビルド・最終レポート（T-801）

少なくとも次の画面をブラウザで確認してください（必要に応じてテストユーザー/インストラクター/管理者を Cognito で作成）：

/（初回アクセス時のヘッダーの挙動も含む）

/user（ログイン済・未ログイン・管理者ログイン中）

/user/profile/setup（新規保存／再読み込み）

/instructor + すべてのサブメニュー

/instructor/profile/setup（新規作成後の誘導）

/manage/login, /manage/admin

npm run build を実行し、ビルドが通ることを確認

ESLint が古いオプションで落ちる場合、ビルド成功を優先し、lint の調整は別タスクとしてメモしておいてください。

最後に、Markdown 形式の「作業完了レポート」 を出力してください。
各タスク T-101〜T-801 について：

何を調査・確認したか

どのファイルをどう変更したか

実行したコマンド（npm run build など）と結果

最終的な画面挙動（URLごと）の要約

を簡潔にまとめてください。

以上です。
タスクを T-101 から順番に進め、途中で必要に応じて小タスクに分割しながら、自律的に作業を進めてください。